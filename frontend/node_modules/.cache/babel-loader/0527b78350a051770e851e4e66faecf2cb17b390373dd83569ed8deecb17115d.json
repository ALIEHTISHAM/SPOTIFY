{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\maali\\\\OneDrive\\\\Desktop\\\\MUSIC\\\\frontend\\\\src\\\\components\\\\CancelSubscription.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect } from 'react';\nimport { useSubscription } from '../context/SubscriptionContext';\nimport { useAuth } from '../context/AuthContext';\nimport '../styles/CancelSubscription.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CancelSubscription = () => {\n  _s();\n  const {\n    hasSubscription,\n    loading,\n    cancelSubscription,\n    subscriptionDetails\n  } = useSubscription();\n  const {\n    user\n  } = useAuth();\n  useEffect(() => {\n    // console.log('CancelSubscription mounted');\n    // console.log('hasSubscription (from context):', hasSubscription);\n    // console.log('loading:', loading);\n    // console.log('user:', user);\n    // console.log('subscriptionDetails (from context):', subscriptionDetails);\n  }, [hasSubscription, loading, user, subscriptionDetails]);\n\n  // Add detailed logs for rendering conditions\n  useEffect(() => {\n    // console.log('CancelSubscription rendering check:');\n    // console.log('  loading:', loading);\n    // console.log('  subscriptionDetails:', subscriptionDetails);\n    if (subscriptionDetails) {\n      // console.log('  subscriptionDetails.status (from DB):', subscriptionDetails.status);\n      // console.log('  subscriptionDetails.hasSubscription (current access):', subscriptionDetails.hasSubscription);\n      // console.log('  subscriptionDetails.currentPeriodEnd:', subscriptionDetails.currentPeriodEnd);\n      // Note: currentPeriodEnd here is the *effective* end date of access from the backend\n      // const effectiveEndDate = new Date(subscriptionDetails.currentPeriodEnd);\n      // console.log('  Effective end date object:', effectiveEndDate);\n      // console.log('  Current date object:', new Date());\n      // console.log('  Is effective end date <= current date:', effectiveEndDate <= new Date());\n    }\n    const isCancelledInDB = (subscriptionDetails === null || subscriptionDetails === void 0 ? void 0 : subscriptionDetails.status) === 'cancelled';\n    const hasCurrentAccess = subscriptionDetails === null || subscriptionDetails === void 0 ? void 0 : subscriptionDetails.hasSubscription;\n    const hasDetails = !!subscriptionDetails;\n    const shouldReturnNull = !hasDetails || isCancelledInDB && !hasCurrentAccess;\n    const shouldShowCancelledMessage = hasDetails && isCancelledInDB && hasCurrentAccess; // Only show message if cancelled but still has access\n    const shouldShowCancelButton = hasDetails && !isCancelledInDB && hasCurrentAccess; // Only show button if active in DB and has access\n\n    // console.log('  isCancelledInDB:', isCancelledInDB);\n    // console.log('  hasCurrentAccess:', hasCurrentAccess);\n    // console.log('  hasDetails:', hasDetails);\n    // console.log('  shouldReturnNull:', shouldReturnNull);\n    // console.log('  shouldShowCancelledMessage:', shouldShowCancelledMessage);\n    // console.log('  shouldShowCancelButton:', shouldShowCancelButton);\n  }, [loading, subscriptionDetails]);\n  if (loading) {\n    // console.log('CancelSubscription: Rendering loading state.');\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cancel-subscription-loading\",\n      children: \"Loading subscription status...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Function to format date\n  const formatDate = dateString => {\n    if (!dateString) return 'N/A';\n    const options = {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    };\n    return new Date(dateString).toLocaleDateString(undefined, options);\n  };\n\n  // Render logic based on subscription details from backend\n  // Check if we should render null (no subscription details or cancelled and access ended)\n  if (!subscriptionDetails || subscriptionDetails.status === 'cancelled' && !subscriptionDetails.hasSubscription) {\n    // console.log('CancelSubscription: Returning null (no subscription or cancelled and access ended).');\n    return null;\n  }\n\n  // Check if we should show the cancelled message (cancelled in DB AND still has access)\n  if (subscriptionDetails.status === 'cancelled' && subscriptionDetails.hasSubscription) {\n    // console.log('CancelSubscription: Rendering cancelled message (DB status is cancelled and has access).');\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cancel-subscription\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Subscription Management\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"cancel-note\",\n        children: [\"Your subscription is set to cancel on \", formatDate(subscriptionDetails.currentPeriodEnd), \".\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Check if we should show the cancel button (active in DB AND still has access)\n  if (subscriptionDetails.status === 'active' && subscriptionDetails.hasSubscription) {\n    // console.log('CancelSubscription: Rendering cancel button (DB status active and has access).');\n    const handleCancel = async () => {\n      try {\n        const result = await cancelSubscription();\n        // console.log('Cancel subscription result:', result);\n        if (result.success) {\n          alert('Your subscription will be cancelled at the end of the billing period.');\n        } else {\n          alert(result.message || 'Failed to cancel subscription. Please try again.');\n        }\n      } catch (error) {\n        // console.error('Error cancelling subscription:', error);\n        alert('An error occurred while cancelling your subscription. Please try again.');\n      }\n    };\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"cancel-subscription\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Subscription Management\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"cancel-button\",\n        onClick: handleCancel,\n        children: \"Cancel Subscription\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"cancel-note\",\n        children: \"Your subscription will remain active until the end of the current billing period.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Fallback: Should theoretically not be reached if logic covers all states, but included for safety\n  // console.log('CancelSubscription: Returning null - Fallback.', subscriptionDetails);\n  return null;\n};\n_s(CancelSubscription, \"FHHJ/+GdWKQWSqJYx4AMWo17/9c=\", false, function () {\n  return [useSubscription, useAuth];\n});\n_c = CancelSubscription;\nexport default CancelSubscription;\nvar _c;\n$RefreshReg$(_c, \"CancelSubscription\");","map":{"version":3,"names":["React","useEffect","useSubscription","useAuth","jsxDEV","_jsxDEV","CancelSubscription","_s","hasSubscription","loading","cancelSubscription","subscriptionDetails","user","isCancelledInDB","status","hasCurrentAccess","hasDetails","shouldReturnNull","shouldShowCancelledMessage","shouldShowCancelButton","className","children","fileName","_jsxFileName","lineNumber","columnNumber","formatDate","dateString","options","year","month","day","Date","toLocaleDateString","undefined","currentPeriodEnd","handleCancel","result","success","alert","message","error","onClick","_c","$RefreshReg$"],"sources":["C:/Users/maali/OneDrive/Desktop/MUSIC/frontend/src/components/CancelSubscription.js"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { useSubscription } from '../context/SubscriptionContext';\r\nimport { useAuth } from '../context/AuthContext';\r\nimport '../styles/CancelSubscription.css';\r\n\r\nconst CancelSubscription = () => {\r\n  const { hasSubscription, loading, cancelSubscription, subscriptionDetails } = useSubscription();\r\n  const { user } = useAuth();\r\n\r\n  useEffect(() => {\r\n    // console.log('CancelSubscription mounted');\r\n    // console.log('hasSubscription (from context):', hasSubscription);\r\n    // console.log('loading:', loading);\r\n    // console.log('user:', user);\r\n    // console.log('subscriptionDetails (from context):', subscriptionDetails);\r\n  }, [hasSubscription, loading, user, subscriptionDetails]);\r\n\r\n  // Add detailed logs for rendering conditions\r\n  useEffect(() => {\r\n    // console.log('CancelSubscription rendering check:');\r\n    // console.log('  loading:', loading);\r\n    // console.log('  subscriptionDetails:', subscriptionDetails);\r\n    if (subscriptionDetails) {\r\n      // console.log('  subscriptionDetails.status (from DB):', subscriptionDetails.status);\r\n      // console.log('  subscriptionDetails.hasSubscription (current access):', subscriptionDetails.hasSubscription);\r\n      // console.log('  subscriptionDetails.currentPeriodEnd:', subscriptionDetails.currentPeriodEnd);\r\n      // Note: currentPeriodEnd here is the *effective* end date of access from the backend\r\n      // const effectiveEndDate = new Date(subscriptionDetails.currentPeriodEnd);\r\n      // console.log('  Effective end date object:', effectiveEndDate);\r\n      // console.log('  Current date object:', new Date());\r\n      // console.log('  Is effective end date <= current date:', effectiveEndDate <= new Date());\r\n    }\r\n\r\n    const isCancelledInDB = subscriptionDetails?.status === 'cancelled';\r\n    const hasCurrentAccess = subscriptionDetails?.hasSubscription;\r\n    const hasDetails = !!subscriptionDetails;\r\n\r\n    const shouldReturnNull = !hasDetails || (isCancelledInDB && !hasCurrentAccess);\r\n    const shouldShowCancelledMessage = hasDetails && isCancelledInDB && hasCurrentAccess; // Only show message if cancelled but still has access\r\n    const shouldShowCancelButton = hasDetails && !isCancelledInDB && hasCurrentAccess; // Only show button if active in DB and has access\r\n\r\n    // console.log('  isCancelledInDB:', isCancelledInDB);\r\n    // console.log('  hasCurrentAccess:', hasCurrentAccess);\r\n    // console.log('  hasDetails:', hasDetails);\r\n    // console.log('  shouldReturnNull:', shouldReturnNull);\r\n    // console.log('  shouldShowCancelledMessage:', shouldShowCancelledMessage);\r\n    // console.log('  shouldShowCancelButton:', shouldShowCancelButton);\r\n\r\n  }, [loading, subscriptionDetails]);\r\n\r\n  if (loading) {\r\n    // console.log('CancelSubscription: Rendering loading state.');\r\n    return <div className=\"cancel-subscription-loading\">Loading subscription status...</div>;\r\n  }\r\n\r\n  // Function to format date\r\n  const formatDate = (dateString) => {\r\n    if (!dateString) return 'N/A';\r\n    const options = { year: 'numeric', month: 'long', day: 'numeric' };\r\n    return new Date(dateString).toLocaleDateString(undefined, options);\r\n  };\r\n\r\n  // Render logic based on subscription details from backend\r\n  // Check if we should render null (no subscription details or cancelled and access ended)\r\n  if (!subscriptionDetails || (subscriptionDetails.status === 'cancelled' && !subscriptionDetails.hasSubscription)) {\r\n     // console.log('CancelSubscription: Returning null (no subscription or cancelled and access ended).');\r\n     return null;\r\n  }\r\n\r\n  // Check if we should show the cancelled message (cancelled in DB AND still has access)\r\n  if (subscriptionDetails.status === 'cancelled' && subscriptionDetails.hasSubscription) {\r\n    // console.log('CancelSubscription: Rendering cancelled message (DB status is cancelled and has access).');\r\n    return (\r\n      <div className=\"cancel-subscription\">\r\n        <h3>Subscription Management</h3>\r\n        <p className=\"cancel-note\">\r\n          Your subscription is set to cancel on {formatDate(subscriptionDetails.currentPeriodEnd)}.\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Check if we should show the cancel button (active in DB AND still has access)\r\n  if (subscriptionDetails.status === 'active' && subscriptionDetails.hasSubscription) {\r\n     // console.log('CancelSubscription: Rendering cancel button (DB status active and has access).');\r\n     const handleCancel = async () => {\r\n      try {\r\n        const result = await cancelSubscription();\r\n        // console.log('Cancel subscription result:', result);\r\n        if (result.success) {\r\n          alert('Your subscription will be cancelled at the end of the billing period.');\r\n        } else {\r\n          alert(result.message || 'Failed to cancel subscription. Please try again.');\r\n        }\r\n      } catch (error) {\r\n        // console.error('Error cancelling subscription:', error);\r\n        alert('An error occurred while cancelling your subscription. Please try again.');\r\n      }\r\n    };\r\n\r\n    return (\r\n      <div className=\"cancel-subscription\">\r\n        <h3>Subscription Management</h3>\r\n        <button \r\n          className=\"cancel-button\"\r\n          onClick={handleCancel}\r\n        >\r\n          Cancel Subscription\r\n        </button>\r\n        <p className=\"cancel-note\">\r\n          Your subscription will remain active until the end of the current billing period.\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Fallback: Should theoretically not be reached if logic covers all states, but included for safety\r\n   // console.log('CancelSubscription: Returning null - Fallback.', subscriptionDetails);\r\n   return null;\r\n};\r\n\r\nexport default CancelSubscription; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}