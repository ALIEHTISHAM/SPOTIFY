{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\maali\\\\OneDrive\\\\Desktop\\\\MUSIC\\\\frontend\\\\src\\\\components\\\\CommentOverlay.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst overlayStyle = {\n  position: 'fixed',\n  top: 0,\n  left: 0,\n  width: '100vw',\n  height: '100vh',\n  background: 'rgba(0,0,0,0.3)',\n  zIndex: 2000,\n  display: 'flex',\n  justifyContent: 'flex-end'\n};\nconst drawerStyle = {\n  width: 'min(400px, 100vw)',\n  maxWidth: '100vw',\n  height: '100vh',\n  background: '#181818',\n  boxShadow: '-2px 0 16px rgba(0,0,0,0.2)',\n  display: 'flex',\n  flexDirection: 'column',\n  position: 'relative',\n  animation: 'slideInRight 0.2s'\n};\nconst headerStyle = {\n  display: 'flex',\n  alignItems: 'center',\n  justifyContent: 'space-between',\n  padding: '1rem',\n  borderBottom: '1px solid #222',\n  background: '#222'\n};\nconst commentsListStyle = {\n  flex: 1,\n  overflowY: 'auto',\n  padding: '1rem',\n  color: 'white'\n};\nconst inputSectionStyle = {\n  borderTop: '1px solid #222',\n  padding: '1rem',\n  background: '#222',\n  display: 'flex',\n  flexDirection: 'column',\n  gap: '0.5rem'\n};\nconst closeBtnStyle = {\n  background: 'none',\n  border: 'none',\n  color: '#fff',\n  fontSize: '1.5rem',\n  cursor: 'pointer'\n};\nconst replyInputStyle = {\n  width: '100%',\n  minHeight: '40px',\n  borderRadius: '6px',\n  padding: '0.3rem',\n  border: '1px solid #444',\n  background: '#222',\n  color: 'white',\n  marginTop: '0.3rem',\n  marginBottom: '0.3rem'\n};\nfunction CommentOverlay({\n  open,\n  onClose,\n  track\n}) {\n  _s();\n  const drawerRef = useRef();\n  const [comments, setComments] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [newComment, setNewComment] = useState('');\n  const [replyInputs, setReplyInputs] = useState({}); // {commentId: replyText}\n  const [replying, setReplying] = useState({}); // {commentId: bool}\n  const [openReplies, setOpenReplies] = useState({}); // {commentId: true/false}\n  const [showReplyInput, setShowReplyInput] = useState({}); // {commentId: bool}\n  const replyInputRefs = useRef({});\n\n  // Fetch top-level comments when overlay opens or track changes\n  const fetchComments = async () => {\n    if (!(track !== null && track !== void 0 && track._id)) return;\n    setLoading(true);\n    try {\n      const res = await axios.get(`http://localhost:5000/api/comments/track/${track._id}/comments`);\n      setComments(res.data.comments || []);\n    } catch {\n      setComments([]);\n    } finally {\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    if (!open || !(track !== null && track !== void 0 && track._id)) return;\n    fetchComments();\n    setOpenReplies({}); // Hide all replies by default when overlay opens or track changes\n  }, [open, track]);\n\n  // Add a new top-level comment\n  const handleAddComment = async () => {\n    if (!newComment.trim()) return;\n    setLoading(true);\n    try {\n      const token = localStorage.getItem('token');\n      await axios.post(`http://localhost:5000/api/comments/track/${track._id}/add`, {\n        text: newComment.trim()\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setNewComment('');\n      await fetchComments(); // Re-fetch all comments from backend\n    } catch (err) {\n      var _err$response, _err$response$data;\n      alert(((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.message) || 'Error adding comment');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Add a reply to a comment (always to top-level comment)\n  const handleAddReply = async commentId => {\n    var _replyInputs$commentI;\n    const replyText = (_replyInputs$commentI = replyInputs[commentId]) === null || _replyInputs$commentI === void 0 ? void 0 : _replyInputs$commentI.trim();\n    if (!replyText) return;\n    setReplying(r => ({\n      ...r,\n      [commentId]: true\n    }));\n    try {\n      const token = localStorage.getItem('token');\n      const res = await axios.post(`http://localhost:5000/api/comments/comment/${commentId}/reply`, {\n        trackId: track._id,\n        text: replyText\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setReplyInputs(i => ({\n        ...i,\n        [commentId]: ''\n      }));\n      setShowReplyInput(i => ({\n        ...i,\n        [commentId]: false\n      })); // Hide input after reply\n      // Update replies in state for this comment\n      setComments(comments => comments.map(c => c._id === commentId ? {\n        ...c,\n        replies: [...(c.replies || []), res.data.comment]\n      } : c));\n    } catch (err) {\n      var _err$response2, _err$response2$data;\n      alert(((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message) || 'Error adding reply');\n    } finally {\n      setReplying(r => ({\n        ...r,\n        [commentId]: false\n      }));\n    }\n  };\n\n  // New: handle reply to a top-level comment (pre-fill @ParentUserName)\n  const handleReplyToComment = (commentId, parentUserName) => {\n    setReplyInputs(inputs => {\n      var _inputs$commentId;\n      return {\n        ...inputs,\n        [commentId]: (_inputs$commentId = inputs[commentId]) !== null && _inputs$commentId !== void 0 && _inputs$commentId.startsWith(`@${parentUserName} `) ? inputs[commentId] : `@${parentUserName} `\n      };\n    });\n    setShowReplyInput(inputs => ({\n      ...inputs,\n      [commentId]: !inputs[commentId]\n    }));\n    setTimeout(() => {\n      const input = replyInputRefs.current[commentId];\n      if (input) {\n        input.focus();\n        // Move cursor to end of prefill\n        const val = input.value;\n        input.setSelectionRange(val.length, val.length);\n      }\n    }, 0);\n  };\n\n  // New: handle reply to a reply (pre-fill @username in the parent comment's reply input)\n  const handleReplyToReply = (parentCommentId, replyUserName) => {\n    setReplyInputs(inputs => {\n      var _inputs$parentComment;\n      return {\n        ...inputs,\n        [parentCommentId]: (_inputs$parentComment = inputs[parentCommentId]) !== null && _inputs$parentComment !== void 0 && _inputs$parentComment.startsWith(`@${replyUserName} `) ? inputs[parentCommentId] : `@${replyUserName} `\n      };\n    });\n    setShowReplyInput(inputs => ({\n      ...inputs,\n      [parentCommentId]: true\n    })); // Always open\n    setTimeout(() => {\n      const input = replyInputRefs.current[parentCommentId];\n      if (input) {\n        input.focus();\n        // Move cursor to end of prefill\n        const val = input.value;\n        input.setSelectionRange(val.length, val.length);\n      }\n    }, 0);\n  };\n\n  // Toggle replies for a comment\n  const handleToggleReplies = async commentId => {\n    setOpenReplies(prev => ({\n      ...prev,\n      [commentId]: !prev[commentId]\n    }));\n  };\n\n  // Helper: Render reply text with styled @username if present\n  function renderReplyText(text) {\n    const match = text.match(/^@(\\S+)\\s(.*)$/);\n    if (match) {\n      return /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            color: '#1e90ff',\n            fontWeight: 500\n          },\n          children: `@${match[1]}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 11\n        }, this), ' ', match[2]]\n      }, void 0, true);\n    }\n    return text;\n  }\n  if (!open) return null;\n  function handleOverlayClick(e) {\n    if (drawerRef.current && !drawerRef.current.contains(e.target)) {\n      onClose();\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: overlayStyle,\n    onMouseDown: handleOverlayClick,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: drawerRef ? drawerStyle : {},\n      ref: drawerRef,\n      onMouseDown: e => e.stopPropagation(),\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: headerStyle,\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: [/*#__PURE__*/_jsxDEV(\"b\", {\n            children: \"Comments\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 17\n          }, this), \" \\u2014 \", track === null || track === void 0 ? void 0 : track.title]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onClose,\n          style: closeBtnStyle,\n          \"aria-label\": \"Close\",\n          children: \"\\xD7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: commentsListStyle,\n        children: [loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#aaa'\n          },\n          children: \"Loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 22\n        }, this) : null, !loading && comments.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            color: '#aaa'\n          },\n          children: \"No comments yet. Be the first to comment!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 13\n        }, this) : comments.map(c => {\n          var _c$user, _c$replies;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginBottom: '1.2rem',\n              borderBottom: '1px solid #222',\n              paddingBottom: '0.7rem'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"b\", {\n              style: {\n                color: '#1db954'\n              },\n              children: ((_c$user = c.user) === null || _c$user === void 0 ? void 0 : _c$user.name) || 'User'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 228,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: '0.2rem',\n                color: '#fff'\n              },\n              children: c.text\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 229,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                flexDirection: 'row',\n                gap: '1.2rem',\n                marginTop: '0.3rem'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                style: {\n                  background: 'none',\n                  color: '#1e90ff',\n                  border: 'none',\n                  cursor: 'pointer',\n                  fontSize: '0.95em'\n                },\n                onClick: () => {\n                  var _c$user2;\n                  return handleReplyToComment(c._id, ((_c$user2 = c.user) === null || _c$user2 === void 0 ? void 0 : _c$user2.name) || 'User');\n                },\n                children: \"Reply\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 232,\n                columnNumber: 19\n              }, this), c.replies && c.replies.length > 0 && /*#__PURE__*/_jsxDEV(\"button\", {\n                style: {\n                  background: 'none',\n                  color: '#1e90ff',\n                  border: 'none',\n                  cursor: 'pointer',\n                  fontSize: '0.95em'\n                },\n                onClick: () => handleToggleReplies(c._id),\n                children: openReplies[c._id] ? 'Hide Replies' : 'View Replies'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 240,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 231,\n              columnNumber: 17\n            }, this), showReplyInput[c._id] && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginLeft: '1.2rem',\n                marginTop: '0.5rem'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n                ref: el => replyInputRefs.current[c._id] = el,\n                style: replyInputStyle,\n                placeholder: \"Write a reply...\",\n                value: replyInputs[c._id] || '',\n                onChange: e => setReplyInputs(i => ({\n                  ...i,\n                  [c._id]: e.target.value\n                }))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 251,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                style: {\n                  background: '#1db954',\n                  color: 'white',\n                  border: 'none',\n                  borderRadius: '6px',\n                  padding: '0.3rem 1rem',\n                  cursor: 'pointer',\n                  marginTop: '0.2rem'\n                },\n                onClick: () => handleAddReply(c._id),\n                disabled: replying[c._id],\n                children: replying[c._id] ? 'Replying...' : 'Reply'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 258,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 250,\n              columnNumber: 19\n            }, this), openReplies[c._id] && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginLeft: '1.2rem',\n                marginTop: '0.5rem'\n              },\n              children: ((_c$replies = c.replies) === null || _c$replies === void 0 ? void 0 : _c$replies.length) === 0 || !c.replies ? /*#__PURE__*/_jsxDEV(\"span\", {\n                style: {\n                  color: '#aaa'\n                },\n                children: \"No replies yet.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 271,\n                columnNumber: 23\n              }, this) : c.replies.map(r => {\n                var _r$user;\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    marginBottom: '0.7rem'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                    style: {\n                      color: '#1db954'\n                    },\n                    children: ((_r$user = r.user) === null || _r$user === void 0 ? void 0 : _r$user.name) || 'User'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 275,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      color: '#fff'\n                    },\n                    children: renderReplyText(r.text)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 276,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    style: {\n                      background: 'none',\n                      color: '#1e90ff',\n                      border: 'none',\n                      cursor: 'pointer',\n                      fontSize: '0.92em',\n                      marginLeft: '0.5rem'\n                    },\n                    onClick: () => {\n                      var _r$user2;\n                      return handleReplyToReply(c._id, ((_r$user2 = r.user) === null || _r$user2 === void 0 ? void 0 : _r$user2.name) || 'User');\n                    },\n                    children: \"Reply\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 278,\n                    columnNumber: 27\n                  }, this)]\n                }, r._id, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 274,\n                  columnNumber: 25\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 19\n            }, this)]\n          }, c._id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 227,\n            columnNumber: 15\n          }, this);\n        })]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: inputSectionStyle,\n        children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n          placeholder: \"Write your comment...\",\n          style: {\n            width: '100%',\n            minHeight: '60px',\n            borderRadius: '6px',\n            padding: '0.5rem',\n            border: '1px solid #444',\n            background: '#181818',\n            color: 'white',\n            resize: 'vertical'\n          },\n          value: newComment,\n          onChange: e => setNewComment(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          style: {\n            background: '#1db954',\n            color: 'white',\n            border: 'none',\n            borderRadius: '6px',\n            padding: '0.5rem 1.2rem',\n            cursor: 'pointer',\n            alignSelf: 'flex-end'\n          },\n          onClick: handleAddComment,\n          disabled: loading,\n          children: loading ? 'Commenting...' : 'Comment'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"style\", {\n        children: `\n        @keyframes slideInRight {\n          from { transform: translateX(100%); }\n          to { transform: translateX(0); }\n        }\n      `\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 215,\n    columnNumber: 5\n  }, this);\n}\n_s(CommentOverlay, \"hqAWDqWRbA30GzjfAl1bTtSmVDw=\");\n_c = CommentOverlay;\nexport default CommentOverlay;\nvar _c;\n$RefreshReg$(_c, \"CommentOverlay\");","map":{"version":3,"names":["React","useRef","useEffect","useState","axios","jsxDEV","_jsxDEV","Fragment","_Fragment","overlayStyle","position","top","left","width","height","background","zIndex","display","justifyContent","drawerStyle","maxWidth","boxShadow","flexDirection","animation","headerStyle","alignItems","padding","borderBottom","commentsListStyle","flex","overflowY","color","inputSectionStyle","borderTop","gap","closeBtnStyle","border","fontSize","cursor","replyInputStyle","minHeight","borderRadius","marginTop","marginBottom","CommentOverlay","open","onClose","track","_s","drawerRef","comments","setComments","loading","setLoading","newComment","setNewComment","replyInputs","setReplyInputs","replying","setReplying","openReplies","setOpenReplies","showReplyInput","setShowReplyInput","replyInputRefs","fetchComments","_id","res","get","data","handleAddComment","trim","token","localStorage","getItem","post","text","headers","Authorization","err","_err$response","_err$response$data","alert","response","message","handleAddReply","commentId","_replyInputs$commentI","replyText","r","trackId","i","map","c","replies","comment","_err$response2","_err$response2$data","handleReplyToComment","parentUserName","inputs","_inputs$commentId","startsWith","setTimeout","input","current","focus","val","value","setSelectionRange","length","handleReplyToReply","parentCommentId","replyUserName","_inputs$parentComment","handleToggleReplies","prev","renderReplyText","match","children","style","fontWeight","fileName","_jsxFileName","lineNumber","columnNumber","handleOverlayClick","e","contains","target","onMouseDown","ref","stopPropagation","title","onClick","_c$user","_c$replies","paddingBottom","user","name","_c$user2","marginLeft","el","placeholder","onChange","disabled","_r$user","_r$user2","resize","alignSelf","_c","$RefreshReg$"],"sources":["C:/Users/maali/OneDrive/Desktop/MUSIC/frontend/src/components/CommentOverlay.js"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst overlayStyle = {\r\n  position: 'fixed',\r\n  top: 0,\r\n  left: 0,\r\n  width: '100vw',\r\n  height: '100vh',\r\n  background: 'rgba(0,0,0,0.3)',\r\n  zIndex: 2000,\r\n  display: 'flex',\r\n  justifyContent: 'flex-end',\r\n};\r\n\r\nconst drawerStyle = {\r\n  width: 'min(400px, 100vw)',\r\n  maxWidth: '100vw',\r\n  height: '100vh',\r\n  background: '#181818',\r\n  boxShadow: '-2px 0 16px rgba(0,0,0,0.2)',\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  position: 'relative',\r\n  animation: 'slideInRight 0.2s',\r\n};\r\n\r\nconst headerStyle = {\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  justifyContent: 'space-between',\r\n  padding: '1rem',\r\n  borderBottom: '1px solid #222',\r\n  background: '#222',\r\n};\r\n\r\nconst commentsListStyle = {\r\n  flex: 1,\r\n  overflowY: 'auto',\r\n  padding: '1rem',\r\n  color: 'white',\r\n};\r\n\r\nconst inputSectionStyle = {\r\n  borderTop: '1px solid #222',\r\n  padding: '1rem',\r\n  background: '#222',\r\n  display: 'flex',\r\n  flexDirection: 'column',\r\n  gap: '0.5rem',\r\n};\r\n\r\nconst closeBtnStyle = {\r\n  background: 'none',\r\n  border: 'none',\r\n  color: '#fff',\r\n  fontSize: '1.5rem',\r\n  cursor: 'pointer',\r\n};\r\n\r\nconst replyInputStyle = {\r\n  width: '100%',\r\n  minHeight: '40px',\r\n  borderRadius: '6px',\r\n  padding: '0.3rem',\r\n  border: '1px solid #444',\r\n  background: '#222',\r\n  color: 'white',\r\n  marginTop: '0.3rem',\r\n  marginBottom: '0.3rem',\r\n};\r\n\r\nfunction CommentOverlay({ open, onClose, track }) {\r\n  const drawerRef = useRef();\r\n  const [comments, setComments] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [newComment, setNewComment] = useState('');\r\n  const [replyInputs, setReplyInputs] = useState({}); // {commentId: replyText}\r\n  const [replying, setReplying] = useState({}); // {commentId: bool}\r\n  const [openReplies, setOpenReplies] = useState({}); // {commentId: true/false}\r\n  const [showReplyInput, setShowReplyInput] = useState({}); // {commentId: bool}\r\n  const replyInputRefs = useRef({});\r\n\r\n  // Fetch top-level comments when overlay opens or track changes\r\n  const fetchComments = async () => {\r\n    if (!track?._id) return;\r\n    setLoading(true);\r\n    try {\r\n      const res = await axios.get(`http://localhost:5000/api/comments/track/${track._id}/comments`);\r\n      setComments(res.data.comments || []);\r\n    } catch {\r\n      setComments([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!open || !track?._id) return;\r\n    fetchComments();\r\n    setOpenReplies({}); // Hide all replies by default when overlay opens or track changes\r\n  }, [open, track]);\r\n\r\n  // Add a new top-level comment\r\n  const handleAddComment = async () => {\r\n    if (!newComment.trim()) return;\r\n    setLoading(true);\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      await axios.post(`http://localhost:5000/api/comments/track/${track._id}/add`, {\r\n        text: newComment.trim(),\r\n      }, { headers: { Authorization: `Bearer ${token}` } });\r\n      setNewComment('');\r\n      await fetchComments(); // Re-fetch all comments from backend\r\n    } catch (err) {\r\n      alert(err.response?.data?.message || 'Error adding comment');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Add a reply to a comment (always to top-level comment)\r\n  const handleAddReply = async (commentId) => {\r\n    const replyText = replyInputs[commentId]?.trim();\r\n    if (!replyText) return;\r\n    setReplying(r => ({ ...r, [commentId]: true }));\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const res = await axios.post(`http://localhost:5000/api/comments/comment/${commentId}/reply`, {\r\n        trackId: track._id,\r\n        text: replyText,\r\n      }, { headers: { Authorization: `Bearer ${token}` } });\r\n      setReplyInputs(i => ({ ...i, [commentId]: '' }));\r\n      setShowReplyInput(i => ({ ...i, [commentId]: false })); // Hide input after reply\r\n      // Update replies in state for this comment\r\n      setComments(comments => comments.map(c =>\r\n        c._id === commentId\r\n          ? { ...c, replies: [...(c.replies || []), res.data.comment] }\r\n          : c\r\n      ));\r\n    } catch (err) {\r\n      alert(err.response?.data?.message || 'Error adding reply');\r\n    } finally {\r\n      setReplying(r => ({ ...r, [commentId]: false }));\r\n    }\r\n  };\r\n\r\n  // New: handle reply to a top-level comment (pre-fill @ParentUserName)\r\n  const handleReplyToComment = (commentId, parentUserName) => {\r\n    setReplyInputs(inputs => ({\r\n      ...inputs,\r\n      [commentId]: inputs[commentId]?.startsWith(`@${parentUserName} `)\r\n        ? inputs[commentId]\r\n        : `@${parentUserName} `\r\n    }));\r\n    setShowReplyInput(inputs => ({ ...inputs, [commentId]: !inputs[commentId] }));\r\n    setTimeout(() => {\r\n      const input = replyInputRefs.current[commentId];\r\n      if (input) {\r\n        input.focus();\r\n        // Move cursor to end of prefill\r\n        const val = input.value;\r\n        input.setSelectionRange(val.length, val.length);\r\n      }\r\n    }, 0);\r\n  };\r\n\r\n  // New: handle reply to a reply (pre-fill @username in the parent comment's reply input)\r\n  const handleReplyToReply = (parentCommentId, replyUserName) => {\r\n    setReplyInputs(inputs => ({\r\n      ...inputs,\r\n      [parentCommentId]: inputs[parentCommentId]?.startsWith(`@${replyUserName} `)\r\n        ? inputs[parentCommentId]\r\n        : `@${replyUserName} `\r\n    }));\r\n    setShowReplyInput(inputs => ({ ...inputs, [parentCommentId]: true })); // Always open\r\n    setTimeout(() => {\r\n      const input = replyInputRefs.current[parentCommentId];\r\n      if (input) {\r\n        input.focus();\r\n        // Move cursor to end of prefill\r\n        const val = input.value;\r\n        input.setSelectionRange(val.length, val.length);\r\n      }\r\n    }, 0);\r\n  };\r\n\r\n  // Toggle replies for a comment\r\n  const handleToggleReplies = async (commentId) => {\r\n    setOpenReplies(prev => ({ ...prev, [commentId]: !prev[commentId] }));\r\n  };\r\n\r\n  // Helper: Render reply text with styled @username if present\r\n  function renderReplyText(text) {\r\n    const match = text.match(/^@(\\S+)\\s(.*)$/);\r\n    if (match) {\r\n      return (\r\n        <>\r\n          <span style={{ color: '#1e90ff', fontWeight: 500 }}>{`@${match[1]}`}</span>{' '}{match[2]}\r\n        </>\r\n      );\r\n    }\r\n    return text;\r\n  }\r\n\r\n  if (!open) return null;\r\n\r\n  function handleOverlayClick(e) {\r\n    if (drawerRef.current && !drawerRef.current.contains(e.target)) {\r\n      onClose();\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={overlayStyle} onMouseDown={handleOverlayClick}>\r\n      <div style={drawerRef ? drawerStyle : {}} ref={drawerRef} onMouseDown={e => e.stopPropagation()}>\r\n        <div style={headerStyle}>\r\n          <span><b>Comments</b> — {track?.title}</span>\r\n          <button onClick={onClose} style={closeBtnStyle} aria-label=\"Close\">×</button>\r\n        </div>\r\n        <div style={commentsListStyle}>\r\n          {loading ? <p style={{ color: '#aaa' }}>Loading...</p> : null}\r\n          {!loading && comments.length === 0 ? (\r\n            <p style={{ color: '#aaa' }}>No comments yet. Be the first to comment!</p>\r\n          ) : (\r\n            comments.map(c => (\r\n              <div key={c._id} style={{ marginBottom: '1.2rem', borderBottom: '1px solid #222', paddingBottom: '0.7rem' }}>\r\n                <b style={{ color: '#1db954' }}>{c.user?.name || 'User'}</b>\r\n                <div style={{ marginTop: '0.2rem', color: '#fff' }}>{c.text}</div>\r\n                {/* Improved button layout: Reply and View Replies on separate lines */}\r\n                <div style={{ display: 'flex', flexDirection: 'row', gap: '1.2rem', marginTop: '0.3rem' }}>\r\n                  <button\r\n                    style={{ background: 'none', color: '#1e90ff', border: 'none', cursor: 'pointer', fontSize: '0.95em' }}\r\n                    onClick={() => handleReplyToComment(c._id, c.user?.name || 'User')}\r\n                  >\r\n                    Reply\r\n                  </button>\r\n                  {/* Only show View Replies if there is at least one reply */}\r\n                  {(c.replies && c.replies.length > 0) && (\r\n                    <button\r\n                      style={{ background: 'none', color: '#1e90ff', border: 'none', cursor: 'pointer', fontSize: '0.95em' }}\r\n                      onClick={() => handleToggleReplies(c._id)}\r\n                    >\r\n                      {openReplies[c._id] ? 'Hide Replies' : 'View Replies'}\r\n                    </button>\r\n                  )}\r\n                </div>\r\n                {/* Always show reply input for parent comment */}\r\n                {showReplyInput[c._id] && (\r\n                  <div style={{ marginLeft: '1.2rem', marginTop: '0.5rem' }}>\r\n                    <textarea\r\n                      ref={el => (replyInputRefs.current[c._id] = el)}\r\n                      style={replyInputStyle}\r\n                      placeholder=\"Write a reply...\"\r\n                      value={replyInputs[c._id] || ''}\r\n                      onChange={e => setReplyInputs(i => ({ ...i, [c._id]: e.target.value }))}\r\n                    />\r\n                    <button\r\n                      style={{ background: '#1db954', color: 'white', border: 'none', borderRadius: '6px', padding: '0.3rem 1rem', cursor: 'pointer', marginTop: '0.2rem' }}\r\n                      onClick={() => handleAddReply(c._id)}\r\n                      disabled={replying[c._id]}\r\n                    >\r\n                      {replying[c._id] ? 'Replying...' : 'Reply'}\r\n                    </button>\r\n                  </div>\r\n                )}\r\n                {/* Replies */}\r\n                {openReplies[c._id] && (\r\n                  <div style={{ marginLeft: '1.2rem', marginTop: '0.5rem' }}>\r\n                    {(c.replies?.length === 0 || !c.replies) ? (\r\n                      <span style={{ color: '#aaa' }}>No replies yet.</span>\r\n                    ) : (\r\n                      c.replies.map(r => (\r\n                        <div key={r._id} style={{ marginBottom: '0.7rem' }}>\r\n                          <b style={{ color: '#1db954' }}>{r.user?.name || 'User'}</b>\r\n                          <div style={{ color: '#fff' }}>{renderReplyText(r.text)}</div>\r\n                          {/* Add Reply button for each reply */}\r\n                          <button\r\n                            style={{ background: 'none', color: '#1e90ff', border: 'none', cursor: 'pointer', fontSize: '0.92em', marginLeft: '0.5rem' }}\r\n                            onClick={() => handleReplyToReply(c._id, r.user?.name || 'User')}\r\n                          >\r\n                            Reply\r\n                          </button>\r\n                        </div>\r\n                      ))\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n        <div style={inputSectionStyle}>\r\n          <textarea\r\n            placeholder=\"Write your comment...\"\r\n            style={{ width: '100%', minHeight: '60px', borderRadius: '6px', padding: '0.5rem', border: '1px solid #444', background: '#181818', color: 'white', resize: 'vertical' }}\r\n            value={newComment}\r\n            onChange={e => setNewComment(e.target.value)}\r\n          />\r\n          <button\r\n            style={{ background: '#1db954', color: 'white', border: 'none', borderRadius: '6px', padding: '0.5rem 1.2rem', cursor: 'pointer', alignSelf: 'flex-end' }}\r\n            onClick={handleAddComment}\r\n            disabled={loading}\r\n          >\r\n            {loading ? 'Commenting...' : 'Comment'}\r\n          </button>\r\n        </div>\r\n      <style>{`\r\n        @keyframes slideInRight {\r\n          from { transform: translateX(100%); }\r\n          to { transform: translateX(0); }\r\n        }\r\n      `}</style>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CommentOverlay; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}